<div class="form-view">
    <header class="view-header">
        <h1>Add New Process</h1>
        <p class="subtitle">Start tracking a new job application.</p>
    </header>

    <form #processForm="ngForm" (ngSubmit)="onSubmit()" class="data-form">
        <div class="form-section">
            <div class="form-group">
                <label>Company Name <span class="required">*</span></label>
                <input type="text" name="companyName" [(ngModel)]="process.companyName" required
                    placeholder="e.g. Google" class="input-field">
            </div>

            <div class="form-group">
                <label>Role Title <span class="required">*</span></label>
                <input type="text" name="roleTitle" [(ngModel)]="process.roleTitle" required
                    placeholder="e.g. Senior Software Engineer" class="input-field">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Location <span class="required">*</span></label>
                    <select name="locationSelect" [(ngModel)]="selectedLocation" required class="input-field"
                        (change)="onLocationChange($event)">
                        <option value="">Select location</option>
                        <option *ngFor="let loc of locationOptions" [value]="loc"
                            [class.abroad-option]="loc === 'Abroad'" [class.other-option]="loc === 'Other'">
                            {{loc}}
                        </option>
                    </select>
                    <div *ngIf="selectedLocation === 'Other'" class="form-group" style="margin-top: 12px;">
                        <label>Specify Location</label>
                        <input type="text" name="location" [(ngModel)]="process.location"
                            placeholder="Enter location..." class="input-field" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Work Mode</label>
                    <select name="workMode" [(ngModel)]="process.workMode" class="input-field"
                        (change)="onWorkModeChange($event)">
                        <option value="remote">Remote</option>
                        <option value="hybrid">Hybrid</option>
                        <option value="onsite">On-site</option>
                    </select>
                </div>
            </div>

            <div class="form-group" *ngIf="process.workMode === 'hybrid'">
                <label>Days from Office per Week</label>
                <input type="number" name="daysFromOffice" [(ngModel)]="process.daysFromOffice" min="1" max="5"
                    placeholder="e.g. 2" class="input-field">
                <p class="muted-hint">How many days per week are required in the office?</p>
            </div>

            <div class="form-group">
                <label>Tech Stack <span class="required">*</span></label>
                <input type="text" name="techStack" [(ngModel)]="process.techStack" required
                    placeholder="e.g. Angular, NestJS, Postgres" class="input-field">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Source</label>
                    <input type="text" name="source" [(ngModel)]="process.source" placeholder="e.g. LinkedIn"
                        class="input-field">
                </div>

                <div class="form-group salary-group">
                    <label>Salary Expectation</label>
                    <div class="salary-inputs">
                        <input type="number" name="salaryExpectation" [(ngModel)]="process.salaryExpectation"
                            placeholder="Amount" class="input-field amount-input">

                        <select name="salaryCurrency" [(ngModel)]="process.salaryCurrency"
                            class="input-field currency-select">
                            <option value="ILS">â‚ª (Shekel)</option>
                            <option value="USD">$ (Dollar)</option>
                            <option value="EUR">â‚¬ (Euro)</option>
                            <option value="RON">lei (RON)</option>
                            <option value="GBP">Â£ (GBP)</option>
                            <option value="JPY">Â¥ (JPY)</option>
                            <option value="CNY">Â¥ (CNY)</option>
                            <option value="AUD">A$ (AUD)</option>
                            <option value="CAD">C$ (CAD)</option>
                            <option value="CHF">CHF</option>
                            <option value="HKD">HK$ (HKD)</option>
                            <option value="SGD">S$ (SGD)</option>
                            <option value="INR">â‚¹ (INR)</option>
                            <option value="RUB">â‚½ (RUB)</option>
                        </select>

                        <select name="salaryPeriod" [(ngModel)]="process.salaryPeriod"
                            class="input-field period-select">
                            <option value="Hour">/ Hour</option>
                            <option value="Day">/ Day</option>
                            <option value="Week">/ Week</option>
                            <option value="Month">/ Month</option>
                            <option value="Year">/ Year</option>
                            <option value="Project">/ Project</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Current Stage <span class="required">*</span></label>
                    <select name="currentStage" [(ngModel)]="process.currentStage" required class="input-field">
                        <option *ngFor="let stage of stages" [value]="stage">{{stage}}</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Data From the Phone Call</label>
                    <textarea name="dataFromThePhoneCall" [(ngModel)]="process.dataFromThePhoneCall" rows="4"
                        placeholder="What did you learn in the initial call that makes you interested in this role?..."
                        class="input-field"></textarea>
                    <p class="muted-hint">Capture key insights from your initial conversation with HR/recruiter.</p>
                </div>

                <!-- Initial Invitation Section -->
                <div class="form-section highlight-section">
                    <div class="section-header">
                        <h2>ðŸ“¨ Initial Invitation</h2>
                        <p class="section-desc">Details about how you were initially contacted for this role.</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Invitation Date</label>
                            <div class="input-icon-wrapper">
                                <!-- Helper text input to show dd/mm/yyyy -->
                                <input type="text" [value]="process.initialInviteDate | date:'dd/MM/yyyy'"
                                    (click)="datePicker.showPicker()" class="input-field date-display"
                                    placeholder="dd/mm/yyyy" readonly>

                                <!-- Hidden actual date input -->
                                <input #datePicker type="date" name="initialInviteDate"
                                    [(ngModel)]="process.initialInviteDate"
                                    class="input-field date-input hidden-picker">

                                <span class="field-icon" (click)="datePicker.showPicker()">ðŸ“…</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Invitation Method</label>
                            <select name="initialInviteMethod" [(ngModel)]="process.initialInviteMethod"
                                class="input-field">
                                <option value="">Select method</option>
                                <option value="Email">Email</option>
                                <option value="LinkedIn">LinkedIn</option>
                                <option value="Referral">Referral</option>
                                <option value="Phone Call">Phone Call</option>
                                <option value="Job Board">Job Board</option>
                                <option value="Recruiter">Recruiter</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Invitation Content</label>
                        <textarea name="initialInviteContent" [(ngModel)]="process.initialInviteContent" rows="4"
                            placeholder="Paste or write the invitation content here..." class="input-field"></textarea>
                        <p class="muted-hint">What did the invitation say? Copy-paste or summarize the message.</p>
                    </div>
                </div>


            </div>

            <div class="form-actions">
                <button type="button" class="btn-secondary" routerLink="/">Cancel</button>
                <button type="submit" class="btn-primary">Create Process</button>
            </div>

        </div>
    </form>
</div>

<style>
    .form-view {
        max-width: 600px;
        margin: 0 auto;
    }

    .view-header {
        margin-bottom: 32px;
    }

    .subtitle {
        color: var(--text-secondary);
        margin-top: 4px;
        font-size: 15px;
    }

    .data-form {
        display: flex;
        flex-direction: column;
        gap: 32px;
    }

    .form-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        padding-top: 24px;
        border-top: 1px solid var(--border-color);
    }

    .muted-hint {
        font-size: 12px;
        color: var(--text-muted);
        margin-top: 4px;
        font-style: italic;
    }

    .highlight-section {
        background: var(--accent-light);
        padding: 24px;
        border: 1px solid rgba(67, 97, 238, 0.2);
        border-radius: var(--radius-md);
    }

    .section-header h2 {
        margin: 0;
        font-size: 18px;
    }

    .section-desc {
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 4px;
        margin-bottom: 16px;
    }

    /* Style for Abroad option */
    .abroad-option {
        color: #dc2626;
        font-weight: 600;
    }

    /* Style for Other option */
    .other-option {
        color: #059669;
        font-weight: 600;
    }

    /* Dark theme adjustments */
    body.dark-theme .abroad-option {
        color: #fca5a5;
    }

    body.dark-theme .other-option {
        color: #6ee7b7;
    }

    .input-icon-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }

    .field-icon {
        position: absolute;
        right: 12px;
        cursor: pointer;
        font-size: 16px;
        pointer-events: none;
        /* Let clicks pass through to input if needed, though we handle click explicitly */
    }

    /* Make the calendar icon clickable */
    .field-icon {
        pointer-events: auto;
    }

    .date-input::-webkit-calendar-picker-indicator {
        opacity: 0;
        /* Hide default indicator to use our custom one or just overlay it */
        cursor: pointer;
        position: absolute;
        right: 0;
        top: 0;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
    }

    .hidden-picker {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        z-index: 10;
        cursor: pointer;
    }

    .date-display {
        background-color: white;
        cursor: pointer;
    }

    .salary-inputs {
        display: flex;
        gap: 8px;
    }

    .amount-input {
        flex: 2;
    }

    .currency-select {
        flex: 1;
        min-width: 80px;
    }

    .period-select {
        flex: 1.5;
        min-width: 100px;
    }

    .required {
        color: #ef4444;
        font-weight: bold;
        margin-left: 2px;
    }
</style>