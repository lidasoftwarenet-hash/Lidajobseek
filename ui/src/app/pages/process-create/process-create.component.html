<div class="form-view">
    <div class="form-card">
        <header class="form-hero">
            <span class="form-badge">New Process</span>
            <h1>Add New Process</h1>
            <p class="subtitle">Capture the role details once and keep your pipeline organized.</p>
            <div class="form-meta">Required fields are marked with <span class="required">*</span></div>

            <!-- Form Progress Indicator -->
            <div class="form-progress-container">
                <div class="progress-bar-wrapper">
                    <div class="progress-bar" [style.width.%]="formProgress" [style.background]="progressColor"></div>
                </div>
                <div class="progress-label">
                    <span>Form Completion: <strong>{{ formProgress }}%</strong></span>
                    <span class="progress-hint">{{ formProgress < 100 ? 'Fill required fields' : 'Ready to submit!'
                            }}</span>
                </div>
            </div>
        </header>

        <form #processForm="ngForm" (ngSubmit)="onSubmit()" class="data-form">
            <section class="form-section">
                <div class="section-title">
                    <h2>Role details</h2>
                    <p>Tell us about the company, position, and stack.</p>
                </div>

                <div class="form-group">
                    <label>Company Name <span class="required">*</span></label>
                    <input type="text" name="companyName" [(ngModel)]="process.companyName" required
                        placeholder="e.g. Google" class="input-field">
                    <p class="field-hint">Use the official company name for easy reporting later.</p>
                </div>

                <div class="form-group">
                    <label>Role Title <span class="required">*</span></label>
                    <input type="text" name="roleTitle" [(ngModel)]="process.roleTitle" required
                        placeholder="e.g. Senior Software Engineer" class="input-field">
                </div>

                <div class="form-group">
                    <label>Tech Stack <span class="required">*</span></label>
                    <input type="text" name="techStack" [(ngModel)]="process.techStack" required
                        placeholder="e.g. Angular, NestJS, Postgres" class="input-field">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Source</label>
                        <input type="text" name="source" [(ngModel)]="process.source" placeholder="e.g. LinkedIn"
                            class="input-field">
                    </div>

                    <div class="form-group">
                        <label>Current Stage <span class="required">*</span></label>
                        <select name="currentStage" [(ngModel)]="process.currentStage" required class="input-field">
                            <option *ngFor="let stage of stages" [value]="stage">{{stage}}</option>
                        </select>
                        <p class="field-hint">Manage stages globally in Settings.</p>
                    </div>
                </div>
            </section>

            <section class="form-section">
                <div class="section-title">
                    <h2>Location & work style</h2>
                    <p>Set expectations around location and in-office time.</p>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Location <span class="required" *ngIf="process.workMode !== 'remote'">*</span></label>
                        <div class="location-combobox country-combobox" [class.open]="showLocationDropdown">
                            <input class="input-field" type="text" name="locationSearch" autocomplete="off"
                                [disabled]="process.workMode === 'remote'" [(ngModel)]="locationSearch"
                                (input)="onLocationSearchChange()" (focus)="onLocationSearchChange()"
                                [placeholder]="process.workMode === 'remote' ? 'Not required for Remote' : (selectedCountry ? 'Select town' : 'Type location...')">
                            <button type="button" class="location-toggle country-toggle"
                                aria-label="Toggle location list"
                                [disabled]="process.workMode === 'remote' || !selectedCountry"
                                (click)="toggleLocationDropdown()">
                                <span aria-hidden="true">â–¾</span>
                            </button>
                            <div class="location-dropdown country-dropdown"
                                *ngIf="showLocationDropdown && selectedCountry">
                                <button type="button" class="location-option country-option"
                                    *ngFor="let loc of filteredLocationOptions" (click)="selectLocation(loc)">
                                    {{ loc }}
                                </button>
                                <div class="location-empty country-empty" *ngIf="filteredLocationOptions.length === 0">
                                    No matches found
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Work Mode</label>
                        <select name="workMode" [(ngModel)]="process.workMode" class="input-field"
                            (change)="onWorkModeChange($event)">
                            <option value="remote">Remote</option>
                            <option value="hybrid">Hybrid</option>
                            <option value="onsite">On-site</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" *ngIf="process.workMode === 'hybrid'">
                    <label>Days from Office per Week</label>
                    <input type="number" name="daysFromOffice" [(ngModel)]="process.daysFromOffice" min="1" max="5"
                        placeholder="e.g. 2" class="input-field">
                    <p class="muted-hint">How many days per week are required in the office?</p>
                </div>
            </section>

            <section class="form-section">
                <div class="section-title">
                    <h2>Compensation</h2>
                    <p>Optional, but helpful for comparison and negotiation prep.</p>
                </div>

                <div class="form-group salary-group">
                    <label>Salary Expectation</label>
                    <div class="salary-inputs">
                        <input type="number" name="salaryExpectation" [(ngModel)]="process.salaryExpectation"
                            placeholder="Amount" class="input-field amount-input">

                        <select name="salaryCurrency" [(ngModel)]="process.salaryCurrency"
                            class="input-field currency-select">

                            <option value="USD">$ (Dollar)</option>
                            <option value="EUR">â‚¬ (Euro)</option>
                            <option value="GBP">Â£ (GBP)</option>
                            <option value="JPY">Â¥ (JPY)</option>
                            <option value="CNY">Â¥ (CNY)</option>
                            <option value="AUD">A$ (AUD)</option>
                            <option value="CAD">C$ (CAD)</option>
                            <option value="CHF">CHF</option>
                            <option value="HKD">HK$ (HKD)</option>
                            <option value="SGD">S$ (SGD)</option>
                            <option value="INR">â‚¹ (INR)</option>
                            <option value="RUB">â‚½ (RUB)</option>
                            <option value="ILS">â‚ª (Shekel)</option>
                            <option value="RON">lei (RON)</option>
                        </select>

                        <select name="salaryPeriod" [(ngModel)]="process.salaryPeriod"
                            class="input-field period-select">
                            <option value="Hour">/ Hour</option>
                            <option value="Day">/ Day</option>
                            <option value="Week">/ Week</option>
                            <option value="Month">/ Month</option>
                            <option value="Year">/ Year</option>
                            <option value="Project">/ Project</option>
                        </select>
                    </div>
                </div>
            </section>

            <section class="form-section">
                <div class="section-title">
                    <h2>Conversation notes</h2>
                    <p>Capture the signal from your first call with HR or a recruiter.</p>
                </div>

                <div class="form-group">
                    <label>Data From the Phone Call</label>
                    <textarea name="dataFromThePhoneCall" [(ngModel)]="process.dataFromThePhoneCall"
                        [maxlength]="dataFromCallMaxLength" rows="4"
                        placeholder="What did you learn in the initial call that makes you interested in this role?..."
                        class="input-field"></textarea>
                    <div class="field-footer">
                        <p class="muted-hint">Capture key insights from your initial conversation with HR/recruiter.</p>
                        <span class="char-counter"
                            [class.warning]="process.dataFromThePhoneCall?.length > dataFromCallMaxLength * 0.9">
                            {{ process.dataFromThePhoneCall?.length || 0 }} / {{ dataFromCallMaxLength }}
                        </span>
                    </div>
                </div>
            </section>

            <section class="form-section highlight-section">
                <div class="section-title">
                    <h2>ðŸ“¨ Initial Invitation</h2>
                    <p>Details about how you were initially contacted for this role.</p>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="label-with-icon">
                            <button type="button" class="label-icon" (click)="datePicker.showPicker()"
                                aria-label="Open date picker">
                                ðŸ“…
                            </button>
                            Invitation Date

                        </label>
                        <div class="input-icon-wrapper">
                            <input #datePicker type="date" name="initialInviteDate"
                                [(ngModel)]="process.initialInviteDate" class="input-field date-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Invitation Method</label>
                        <select name="initialInviteMethod" [(ngModel)]="process.initialInviteMethod"
                            class="input-field">
                            <option value="">Select method</option>
                            <option value="Email">Email</option>
                            <option value="LinkedIn">LinkedIn</option>
                            <option value="Referral">Referral</option>
                            <option value="Phone Call">Phone Call</option>
                            <option value="Job Board">Job Board</option>
                            <option value="Recruiter">Recruiter</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Invitation Content</label>
                    <textarea name="initialInviteContent" [(ngModel)]="process.initialInviteContent"
                        [maxlength]="initialInviteContentMaxLength" rows="4"
                        placeholder="Paste or write the invitation content here..." class="input-field"></textarea>
                    <div class="field-footer">
                        <p class="muted-hint">What did the invitation say? Copy-paste or summarize the message.</p>
                        <span class="char-counter"
                            [class.warning]="process.initialInviteContent?.length > initialInviteContentMaxLength * 0.9">
                            {{ process.initialInviteContent?.length || 0 }} / {{ initialInviteContentMaxLength }}
                        </span>
                    </div>
                </div>
            </section>

            <div class="form-actions">
                <button type="button" class="btn-secondary" routerLink="/">Cancel</button>
                <button type="submit" class="btn-primary">Create Process</button>
            </div>
        </form>
    </div>
</div>