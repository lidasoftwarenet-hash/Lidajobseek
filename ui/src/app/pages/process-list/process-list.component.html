<div class="dashboard-container">
    <div class="dashboard-header">
        <div>
            <h1>Processes</h1>
            <p class="subtitle">Manage your job applications</p>
        </div>
        <div class="header-actions">
            <button class="btn-secondary" (click)="exportData()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Export
            </button>
            <button class="btn-secondary" (click)="fileInput.click()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Import
            </button>
            <input #fileInput type="file" (change)="onFileSelected($event)" style="display: none" accept=".json">

            <button class="btn-primary" routerLink="/new">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                New Process
            </button>
        </div>
    </div>

    <!-- Toolbar / Filters -->
    <div class="toolbar">
        <div class="search-wrapper">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input
                type="text"
                [(ngModel)]="searchText"
                (ngModelChange)="applyFilters()"
                placeholder="Search..."
                class="search-input"
            />
        </div>

        <div class="filters-row">
            <select [(ngModel)]="selectedStage" (change)="onStageChange($event)" class="filter-select">
                <option value="">All Stages</option>
                <option *ngFor="let stage of availableStages" [value]="stage">{{ stage }}</option>
            </select>

            <select [(ngModel)]="selectedWorkMode" (change)="onWorkModeChange($event)" class="filter-select">
                <option value="">All Work Modes</option>
                <option *ngFor="let mode of availableWorkModes" [value]="mode">{{ mode | titlecase }}</option>
            </select>

            <label class="checkbox-filter">
                <input type="checkbox" [(ngModel)]="showAllProcesses" (change)="applyFilters()">
                <span>Show Closed</span>
            </label>
        </div>
    </div>

    <!-- Data Grid -->
    <div class="table-container" *ngIf="filteredProcesses.length > 0; else noData">
        <table class="data-table">
            <thead>
                <tr>
                    <th (click)="sort('company')" class="sortable">
                        Company
                        <span class="sort-indicator" *ngIf="isSorted('company')">
                            {{ getSortDirection('company') === 'asc' ? '↑' : '↓' }}
                        </span>
                    </th>
                    <th (click)="sort('stage')" class="sortable">
                        Stage
                        <span class="sort-indicator" *ngIf="isSorted('stage')">
                            {{ getSortDirection('stage') === 'asc' ? '↑' : '↓' }}
                        </span>
                    </th>
                    <th (click)="sort('interactions')" class="sortable">
                        Interactions
                        <span class="sort-indicator" *ngIf="isSorted('interactions')">
                            {{ getSortDirection('interactions') === 'asc' ? '↑' : '↓' }}
                        </span>
                    </th>
                    <th (click)="sort('location')" class="sortable">
                        Location
                        <span class="sort-indicator" *ngIf="isSorted('location')">
                            {{ getSortDirection('location') === 'asc' ? '↑' : '↓' }}
                        </span>
                    </th>
                    <th (click)="sort('updated')" class="sortable">
                        Updated
                        <span class="sort-indicator" *ngIf="isSorted('updated')">
                            {{ getSortDirection('updated') === 'asc' ? '↑' : '↓' }}
                        </span>
                    </th>
                    <th></th> <!-- Actions -->
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let p of filteredProcesses" [class.closed]="p.currentStage === 'Rejected' || p.currentStage === 'Withdrawn'">
                    <td>
                        <div class="company-info">
                            <span class="company-name">{{ p.companyName }}</span>
                            <span class="role-title">{{ p.roleTitle }}</span>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge" [ngClass]="getStatusClass(p.currentStage)">
                            {{ p.currentStage }}
                        </span>
                    </td>
                    <td>
                        <div class="interaction-count">
                            {{ p._count?.interactions || 0 }}
                        </div>
                    </td>
                    <td class="text-secondary">
                        {{ p.location }}
                        <span *ngIf="p.workMode === 'hybrid'" class="hybrid-badge">Hybrid</span>
                    </td>
                    <td class="text-secondary">
                        {{ p.updatedAt | date:'dd/MM/yy' }}
                    </td>
                    <td>
                        <a [routerLink]="['/process', p.id]" class="btn-icon-link">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 18l6-6-6-6"/>
                            </svg>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <ng-template #noData>
        <div class="empty-state">
            <div class="empty-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="12" y1="18" x2="12" y2="12"></line>
                    <line x1="9" y1="15" x2="15" y2="15"></line>
                </svg>
            </div>
            <h3>No processes found</h3>
            <p>Create a new process to get started tracking your applications.</p>
            <button class="btn-primary" routerLink="/new">Create Process</button>
        </div>
    </ng-template>
</div>
