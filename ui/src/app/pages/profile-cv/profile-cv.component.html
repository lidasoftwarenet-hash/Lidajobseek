<div class="cv-shell" *ngIf="!loading && (aiProfile || profile); else loadingState">
    <header class="cv-header">
        <div>
            <span class="cv-label">{{ useAi ? 'ü§ñ AI-Enhanced CV' : 'üìÑ Template CV' }}</span>
            <h1 class="cv-name">Career Profile</h1>
            <p class="cv-subtitle">
                {{ useAi ? 'Professional CV enhanced and refined by DeepSeek AI' : 'Clean template-based CV from your profile' }}
            </p>

            <div class="cv-toggle-options">
                <button class="btn-toggle" [class.active]="!useAi" (click)="loadCv(false)">
                    üìÑ Template Version
                </button>
                <button class="btn-toggle" [class.active]="useAi" (click)="loadCv(true)">
                    ü§ñ AI-Enhanced Version
                </button>
            </div>

            <p class="cv-note" *ngIf="useAi && aiProfile?.aiEnabled">
                ‚úì AI-enhanced using your latest profile data
            </p>
            <p class="cv-warning" *ngIf="useAi && !aiProfile?.aiEnabled">
                ‚ö†Ô∏è DeepSeek AI is not configured. Add DEEPSEEK_API_KEY in backend/.env to enable AI enhancement.
                Showing template version instead.
            </p>
            <p class="cv-note" *ngIf="!useAi">
                Using clean template format from your profile data
            </p>

            <a class="cv-back-link" [routerLink]="['/profile']">
                ‚Üê Back to Profile
            </a>
        </div>

        <!-- Professional Action Buttons -->
        <div class="cv-actions">
            <button class="action-btn action-primary" (click)="downloadAsPdf()" [disabled]="downloadingPdf">
                <span class="action-icon">{{ downloadingPdf ? '‚è≥' : 'üì•' }}</span>
                <span class="action-text">Download PDF</span>
            </button>
            <button class="action-btn" (click)="printCv()">
                <span class="action-icon">üñ®Ô∏è</span>
                <span class="action-text">Print</span>
            </button>
            <button class="action-btn" (click)="copyToClipboard()">
                <span class="action-icon">üìã</span>
                <span class="action-text">Copy</span>
            </button>
            <button class="action-btn" (click)="downloadAsText()">
                <span class="action-icon">üìÑ</span>
                <span class="action-text">Text File</span>
            </button>
        </div>
    </header>

    <div class="cv-body">
        <div class="cv-contact">
            <div class="contact-item">
                <span class="contact-label">Highlights</span>
                <span class="contact-value">{{ aiProfile?.topSkills || profile?.topSkills || 'Add top skills to showcase your strengths.' }}</span>
            </div>
        </div>
    </div>

    <section class="cv-section">
        <h2>About</h2>
        <p>{{ aiProfile?.about || profile?.about || 'Add an about section to give recruiters context.' }}</p>
    </section>

    <section class="cv-grid">
        <div class="cv-card">
            <h3>Experience</h3>
            <p>{{ aiProfile?.experience || profile?.experience || 'Summarize your experience here.' }}</p>
        </div>
        <div class="cv-card">
            <h3>Old Companies</h3>
            <p>{{ aiProfile?.oldCompanies || profile?.oldCompanies || 'List previous companies to show credibility.' }}</p>
        </div>
    </section>

    <section class="cv-grid">
        <div class="cv-card">
            <h3>Activity</h3>
            <p>{{ aiProfile?.activity || profile?.activity || 'Add any public speaking, awards, or community work.' }}</p>
        </div>
        <div class="cv-card">
            <h3>Private Projects</h3>
            <p>{{ aiProfile?.privateProjects || profile?.privateProjects || 'Showcase your side projects and initiatives.' }}</p>
        </div>
    </section>

    <section class="cv-grid">
        <div class="cv-card">
            <h3>Education</h3>
            <p>{{ aiProfile?.education || profile?.education || 'Highlight education and training.' }}</p>
        </div>
        <div class="cv-card">
            <h3>Certifications</h3>
            <p>{{ aiProfile?.certifications || profile?.certifications || 'Add certifications and licenses.' }}</p>
        </div>
    </section>

    <section class="cv-section">
        <h2>Links</h2>
        <p>{{ aiProfile?.links || profile?.links || 'Add portfolio links, GitHub, LinkedIn, etc.' }}</p>
    </section>

    <!-- Share CV Section -->
    <section class="cv-share-section no-print">
        <div class="cv-share-header">
            <h3>Share Your CV</h3>
            <p>Send this CV to another user. If the email exists, we'll confirm it for you.</p>
        </div>
        <div class="cv-share-form">
            <div class="cv-share-input-group">
                <input type="email" name="shareEmail" [(ngModel)]="shareEmail"
                    placeholder="name@company.com" class="cv-share-input">
                <button type="button" class="cv-share-btn" (click)="shareCv()" [disabled]="loading">
                    {{ loading ? 'Sharing...' : 'Share CV' }}
                </button>
            </div>
            <p *ngIf="shareResult" class="cv-share-status"
                [class.success]="shareResult.exists" [class.error]="!shareResult.exists">
                {{ shareResult.exists ? '‚úì User found ‚Äî CV shared successfully.' : '‚úó User not found.' }}
            </p>
        </div>
    </section>

    <!-- Footer with Actions (Print-friendly) -->
    <footer class="cv-footer no-print">
        <div class="cv-footer-actions">
            <button class="btn-footer" (click)="downloadAsPdf()" [disabled]="downloadingPdf">
                üì• {{ downloadingPdf ? 'Generating...' : 'Download PDF' }}
            </button>
            <button class="btn-footer" (click)="copyToClipboard()">
                üìã Copy to Clipboard
            </button>
        </div>
        <p class="cv-footer-note">
            Generated {{ aiProfile?.lastCvGeneratedAt | date: 'medium' }} ‚Ä¢
            {{ useAi ? 'AI-Enhanced' : 'Template' }} Version
        </p>
    </footer>
</div>

<ng-template #loadingState>
    <div class="cv-loading">
        <div class="loading-card"></div>
        <div class="loading-card"></div>
        <div class="loading-card"></div>
    </div>
</ng-template>
