<!-- Premium Upgrade Prompt -->
<div *ngIf="showUpgradePrompt" class="premium-upgrade-container">
    <div class="premium-upgrade-card">
        <div class="premium-upgrade-header">
            <div class="premium-icon">‚ú®</div>
            <h1>AI-Powered CV Generation</h1>
            <p class="premium-subtitle">This feature is available exclusively for Premium users</p>
        </div>
        
        <div class="premium-upgrade-content">
            <div class="premium-features">
                <h3>Unlock the power of AI to enhance your CV:</h3>
                <ul class="premium-features-list">
                    <li>‚ú® AI-enhanced professional summaries</li>
                    <li>‚ú® Optimized skill descriptions</li>
                    <li>‚ú® Industry-specific formatting</li>
                    <li>‚ú® Professional language refinement</li>
                    <li>‚ú® ATS-friendly optimization</li>
                </ul>
            </div>
            
            <div class="premium-cta">
                <a [routerLink]="['/pricing']" class="premium-upgrade-btn">
                    <span>üöÄ Upgrade to Premium</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </a>
                <p class="premium-hint">Start with a 14-day free trial ‚Ä¢ Cancel anytime</p>
            </div>
        </div>
        
        <div class="premium-alternative">
            <a [routerLink]="['/profile/cv']" class="premium-alternative-link">
                ‚Üê Or use Template CV (Free)
            </a>
        </div>
    </div>
</div>

<div class="cv-shell" *ngIf="!showUpgradePrompt && !loading && (cvData || profile); else loadingState">
    <header class="cv-header">
        <div>
            <span class="cv-label">{{ useAi ? 'ü§ñ AI-Enhanced CV' : 'üìÑ Template CV' }}</span>
            <h1 class="cv-name">Career Profile</h1>
            <p class="cv-subtitle">
                {{ useAi ? 'Professional CV enhanced and refined by AI' : 'Clean template-based CV from your profile' }}
            </p>

            <p class="cv-note">
                {{ useAi ? 'AI-enhanced using your latest profile data' : 'Using clean template format from your profile data' }}
            </p>

            <a class="cv-back-link" [routerLink]="['/profile']">
                ‚Üê Back to Profile
            </a>
        </div>

        <!-- Professional Action Buttons -->
        <div class="cv-actions">
            <button class="action-btn action-primary" (click)="downloadAsPdf()" [disabled]="downloadingPdf">
                <span class="action-icon">{{ downloadingPdf ? '‚è≥' : 'üì•' }}</span>
                <span class="action-text">Download PDF</span>
            </button>
            <button class="action-btn" (click)="printCv()">
                <span class="action-icon">üñ®Ô∏è</span>
                <span class="action-text">Print</span>
            </button>
            <button class="action-btn" (click)="copyToClipboard()">
                <span class="action-icon">üìã</span>
                <span class="action-text">Copy</span>
            </button>
            <button class="action-btn" (click)="downloadAsText()">
                <span class="action-icon">üìÑ</span>
                <span class="action-text">Text File</span>
            </button>
        </div>
    </header>

    <div class="cv-body">
        <div class="cv-contact">
            <div class="contact-item">
                <span class="contact-label">Highlights</span>
                <span class="contact-value">{{ cvData?.topSkills || profile?.topSkills || 'Add top skills to showcase your strengths.' }}</span>
            </div>
        </div>
    </div>

    <section class="cv-section">
        <h2>About</h2>
        <p>{{ cvData?.about || profile?.about || 'Add an about section to give recruiters context.' }}</p>
    </section>

    <section class="cv-grid">
        <div class="cv-card">
            <h3>Experience</h3>
            <p>{{ cvData?.experience || profile?.experience || 'Summarize your experience here.' }}</p>
        </div>
        <div class="cv-card">
            <h3>Old Companies</h3>
            <p>{{ cvData?.oldCompanies || profile?.oldCompanies || 'List previous companies to show credibility.' }}</p>
        </div>
    </section>

    <section class="cv-grid">
        <div class="cv-card">
            <h3>Activity</h3>
            <p>{{ cvData?.activity || profile?.activity || 'Add any public speaking, awards, or community work.' }}</p>
        </div>
        <div class="cv-card">
            <h3>Private Projects</h3>
            <p>{{ cvData?.privateProjects || profile?.privateProjects || 'Showcase your side projects and initiatives.' }}</p>
        </div>
    </section>

    <section class="cv-grid">
        <div class="cv-card">
            <h3>Education</h3>
            <p>{{ cvData?.education || profile?.education || 'Highlight education and training.' }}</p>
        </div>
        <div class="cv-card">
            <h3>Certifications</h3>
            <p>{{ cvData?.certifications || profile?.certifications || 'Add certifications and licenses.' }}</p>
        </div>
    </section>

    <section class="cv-section">
        <h2>Links</h2>
        <p>{{ cvData?.links || profile?.links || 'Add portfolio links, GitHub, LinkedIn, etc.' }}</p>
    </section>

    <!-- Share CV Section -->
    <section class="cv-share-section no-print">
        <div class="cv-share-header">
            <h3>Share Your CV</h3>
            <p>Enter any email address and we'll send the CV as a PDF attachment.</p>
        </div>
        <div class="cv-share-form">
            <div class="cv-share-input-group">
                <input type="email" name="shareEmail" [(ngModel)]="shareEmail"
                    placeholder="recipient@example.com" class="cv-share-input">
                <button type="button" class="cv-share-btn" (click)="shareCv()" [disabled]="sendingCv">
                    {{ sendingCv ? 'Sending...' : 'Send CV' }}
                </button>
            </div>
            <p *ngIf="shareStatus === 'success'" class="cv-share-status success">
                ‚úì CV sent successfully!
            </p>
            <p *ngIf="shareStatus === 'error'" class="cv-share-status error">
                ‚úó Failed to send CV. Please retry.
            </p>
        </div>
    </section>

    <!-- Footer with Actions (Print-friendly) -->
    <footer class="cv-footer no-print">
        <div class="cv-footer-actions">
            <button class="btn-footer" (click)="downloadAsPdf()" [disabled]="downloadingPdf">
                üì• {{ downloadingPdf ? 'Generating...' : 'Download PDF' }}
            </button>
            <button class="btn-footer" (click)="copyToClipboard()">
                üìã Copy to Clipboard
            </button>
        </div>
        <p class="cv-footer-note">
            Generated {{ cvData?.lastCvGeneratedAt | date: 'medium' }} ‚Ä¢
            {{ useAi ? 'AI-Enhanced' : 'Template' }} Version
        </p>
    </footer>
</div>

<ng-template #loadingState>
    <div class="cv-loading">
        <div class="loading-card"></div>
        <div class="loading-card"></div>
        <div class="loading-card"></div>
    </div>
</ng-template>
