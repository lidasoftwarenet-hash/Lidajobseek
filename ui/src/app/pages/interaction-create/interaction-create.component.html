<div class="form-view">
    <header class="view-header">
        <h1>Record Interaction</h1>
        <p class="subtitle">Log a new session with interviewers.</p>
    </header>

    <form #interactionForm="ngForm" (ngSubmit)="onSubmit()" class="data-form">
        <div class="form-section">
            <div class="form-row">
                <div class="form-group">
                    <label>Date</label>
                    <div class="input-icon-wrapper">
                        <input type="text" [value]="datePart | date:'dd/MM/yyyy'" (click)="datePicker.showPicker()"
                            class="input-field date-display" placeholder="dd/mm/yyyy" readonly>

                        <input #datePicker type="date" name="datePart" [(ngModel)]="datePart"
                            (change)="updateDateTime()" class="input-field date-input hidden-picker" required>
                        <span class="field-icon" (click)="datePicker.showPicker()">üìÖ</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <div class="input-icon-wrapper">
                        <input #timePicker type="time" name="timePart" [(ngModel)]="timePart"
                            (change)="updateDateTime()" class="input-field date-input" required>
                        <span class="field-icon" (click)="timePicker.showPicker()">‚è∞</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Interview Type</label>
                    <select name="interviewType" [(ngModel)]="interaction.interviewType" class="input-field" required>
                        <option value="call">Call</option>
                        <option value="zoom">Zoom</option>
                        <option value="frontal">Frontal</option>
                        <option value="home assigment">Home Assignment</option>
                    </select>
                </div>
            </div>

            <div class="interviewers-block">
                <div class="section-label-row">
                    <label>Interviewers (Participants)</label>
                    <div class="add-buttons">
                        <!-- Dropdown to add from existing contacts -->
                        <div class="dropdown-wrapper" *ngIf="existingContacts.length > 0">
                            <button type="button" class="btn-text dropdown-trigger">+ Add from Network</button>
                            <div class="dropdown-menu">
                                <div *ngFor="let contact of existingContacts" class="dropdown-item"
                                    (click)="addFromContact(contact)">
                                    <strong>{{ contact.name }}</strong>
                                    <span *ngIf="contact.role" class="muted">({{ contact.role }})</span>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-text" (click)="addParticipant()">+ Add New</button>
                    </div>
                </div>

                <div class="participants-list">
                    <div *ngFor="let p of interaction.participants; let i = index" class="participant-row">
                        <select [name]="'role' + i" [(ngModel)]="p.role" class="input-field small-select">
                            <option *ngFor="let role of availableRoles" [value]="role">{{role}}</option>
                        </select>
                        <input type="text" [name]="'name' + i" [(ngModel)]="p.name" placeholder="Name"
                            class="input-field">
                        <button type="button" class="btn-remove" (click)="removeParticipant(i)">&times;</button>
                    </div>
                    <p class="muted-hint" *ngIf="interaction.participants.length === 0">No interviewers added yet.</p>
                </div>
            </div>

            <div class="form-group">
                <label>Summary</label>
                <textarea name="summary" [(ngModel)]="interaction.summary" rows="3" required
                    placeholder="Main points discussed in the call..." class="input-field"></textarea>
            </div>

            <div class="form-group">
                <label>Tests / Technical Assessment</label>
                <textarea name="testsAssessment" [(ngModel)]="interaction.testsAssessment" rows="2"
                    placeholder="What tests or technical assessments were part of this interview? Describe the questions, challenges, or tasks..."
                    class="input-field"></textarea>
                <p class="muted-hint">Capture details about coding tests, technical questions, or assessments given
                    during the interview.</p>
            </div>

            <div class="form-group">
                <label>Role Insights (What did you learn about the role?)</label>
                <textarea name="roleInsights" [(ngModel)]="interaction.roleInsights" rows="2"
                    placeholder="What did you learn about the role, team, projects, culture? This helps inform 'Why This Role?'..."
                    class="input-field"></textarea>
                <p class="muted-hint">Capture key details about the role that influence your interest.</p>
            </div>

            <div class="form-group">
                <label>Private Notes (optional)</label>
                <textarea name="notes" [(ngModel)]="interaction.notes" rows="2"
                    placeholder="Personal thoughts, impressions, follow-up actions..." class="input-field"></textarea>
            </div>
        </div>



        <div class="form-actions">
            <button type="button" class="btn-secondary" [routerLink]="['/process', processId]">Cancel</button>
            <button type="submit" class="btn-primary" [disabled]="!interactionForm.form.valid">Save Interaction</button>
        </div>
    </form>
</div>

<style>
    .form-view {
        max-width: 500px;
        margin: 0 auto;
    }

    .view-header {
        margin-bottom: 32px;
    }

    .subtitle {
        color: var(--text-secondary);
        margin-top: 4px;
        font-size: 15px;
    }

    .data-form {
        display: flex;
        flex-direction: column;
        gap: 32px;
    }

    .form-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
    }

    .interviewers-block {
        background: var(--bg-subtle);
        padding: 16px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-color);
    }

    .section-label-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .section-label-row label {
        margin-bottom: 0;
    }

    .btn-text {
        background: none;
        border: none;
        color: var(--accent-color);
        padding: 0;
        font-size: 13px;
        font-weight: 100;
    }

    .btn-text:hover {
        text-decoration: underline;
    }

    .participants-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .participant-row {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .small-select {
        width: 140px;
        flex-shrink: 0;
    }

    .btn-remove {
        background: none;
        border: none;
        color: #ef4444;
        font-size: 20px;
        cursor: pointer;
        line-height: 1;
        padding: 0 4px;
    }

    .muted-hint {
        font-size: 12px;
        color: var(--text-muted);
        font-style: italic;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        padding-top: 24px;
        border-top: 1px solid var(--border-color);
    }

    .highlight-section {
        background: #fdfdfd;
        padding: 24px;
        border: 1px solid #eee;
        border-radius: var(--radius-md);
    }

    .section-header h2 {
        margin: 0;
        font-size: 16px;
    }

    .section-desc {
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 4px;
        margin-bottom: 16px;
    }

    .radio-group {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 8px;
    }

    .radio-option {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border-color);
        transition: background-color 0.2s;
    }

    .radio-option:hover {
        background-color: var(--bg-subtle);
    }

    .radio-option input[type="radio"] {
        margin: 0;
    }

    .radio-option span {
        font-size: 14px;
        color: var(--text-primary);
    }

    .add-buttons {
        display: flex;
        gap: 16px;
    }

    .dropdown-wrapper {
        position: relative;
        display: inline-block;
    }

    .dropdown-wrapper:hover .dropdown-menu {
        display: block;
    }

    .dropdown-menu {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-lg);
        min-width: 200px;
        z-index: 100;
        padding: 4px 0;
    }

    .dropdown-item {
        padding: 8px 12px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
    }

    .dropdown-item:hover {
        background-color: var(--bg-subtle);
    }

    .dropdown-item .muted {
        font-size: 11px;
        color: var(--text-muted);
    }

    .hidden-picker {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        z-index: 10;
        cursor: pointer;
    }

    .date-display {
        background-color: white;
        cursor: pointer;
    }
</style>