<div class="hub-container">
    <header class="hub-header">
        <div class="header-left">
            <h1>üß† Interview Coach Hub</h1>
            <p class="subtitle">Your professional career assets library</p>
        </div>
        <div class="header-actions">
            <button class="btn-secondary btn-icon-text" (click)="showConfig = !showConfig">
                <span class="icon">‚öôÔ∏è</span>
                {{ showConfig ? 'Close' : 'Configure' }}
            </button>
        </div>
    </header>

    <!-- Configuration Panel -->
    <div *ngIf="showConfig" class="config-panel">
        <div class="config-header">
            <div>
                <h3>üìÇ Manage Categories</h3>
                <p class="config-hint">Customize your workspace by managing resource categories</p>
            </div>
            <button class="btn-primary btn-sm" (click)="showAddCategory = !showAddCategory">
                <span class="btn-icon">{{ showAddCategory ? '√ó' : '+' }}</span>
                {{ showAddCategory ? 'Cancel' : 'Add Category' }}
            </button>
        </div>

        <!-- Add New Category Form -->
        <div *ngIf="showAddCategory" class="add-category-form">
            <div class="form-grid">
                <div class="form-group">
                    <label>Category Name</label>
                    <input type="text" [(ngModel)]="newCategory.name" placeholder="e.g. Cover Letters"
                        class="input-field">
                </div>
                <div class="form-group">
                    <label>Icon</label>
                    <div class="icon-picker">
                        <button *ngFor="let icon of availableIcons" type="button" class="icon-option"
                            [class.selected]="newCategory.icon === icon" (click)="newCategory.icon = icon">
                            {{ icon }}
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <div class="color-picker">
                        <button *ngFor="let color of availableColors" type="button" class="color-option"
                            [class.selected]="newCategory.color === color" [style.background]="color"
                            (click)="newCategory.color = color">
                        </button>
                    </div>
                </div>
            </div>
            <div class="form-actions-inline">
                <button class="btn-primary" (click)="addNewCategory()">Create Category</button>
                <button class="btn-secondary" (click)="showAddCategory = false; resetNewCategory()">Cancel</button>
            </div>
        </div>

        <!-- Existing Categories -->
        <div class="category-config-grid">
            <div *ngFor="let cat of categories" class="config-item">
                <div class="config-item-content">
                    <div class="config-item-header">
                        <span class="config-icon" [style.color]="cat.color">{{ cat.icon }}</span>
                        <input *ngIf="cat.isEditing" type="text" [(ngModel)]="cat.name" class="edit-input"
                            (keyup.enter)="saveRename(cat)" (keyup.escape)="cancelEdit(cat)">
                        <span *ngIf="!cat.isEditing" class="config-name">{{ cat.name }}</span>
                    </div>
                    <div class="config-actions">
                        <button *ngIf="!cat.isEditing" class="btn-icon-sm" (click)="startEditCategory(cat)"
                            title="Rename">
                            ‚úèÔ∏è
                        </button>
                        <button *ngIf="cat.isEditing" class="btn-icon-sm success" (click)="saveRename(cat)"
                            title="Save">
                            ‚úì
                        </button>
                        <button *ngIf="cat.isEditing" class="btn-icon-sm danger" (click)="cancelEdit(cat)"
                            title="Cancel">
                            √ó
                        </button>
                        <button *ngIf="!cat.isEditing" class="btn-icon-sm danger" (click)="deleteCategory(cat)"
                            title="Delete">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" [(ngModel)]="cat.enabled" (change)="saveCategories()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb" *ngIf="selectedCategory">
        <button class="breadcrumb-link" (click)="backToFolders()">
            <span class="icon">üè†</span> Home
        </button>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">{{ selectedCategoryData?.name }}</span>
    </div>

    <!-- Folder View (Main Categories) -->
    <div *ngIf="!selectedCategory" class="folder-view">
        <div class="folder-grid">
            <div *ngFor="let category of enabledCategories" class="folder-card" (click)="selectCategory(category.id)"
                [style.--folder-color]="category.color">
                <div class="folder-icon-wrapper">
                    <div class="folder-icon">{{ category.icon }}</div>
                </div>
                <div class="folder-info">
                    <h3 class="folder-name">{{ category.name }}</h3>
                    <p class="folder-count">
                        {{ (resources | filter: category.id).length }} item{{ (resources | filter: category.id).length
                        !== 1 ? 's' : '' }}
                    </p>
                </div>
            </div>
        </div>

        <div *ngIf="enabledCategories.length === 0" class="empty-state">
            <div class="empty-icon">üìÇ</div>
            <h3>No categories enabled</h3>
            <p>Enable at least one category in the configuration to get started</p>
            <button class="btn-primary" (click)="showConfig = true">Configure Categories</button>
        </div>
    </div>

    <!-- File List View (Inside a Category) -->
    <div *ngIf="selectedCategory" class="file-view">
        <div class="file-view-header">
            <h2>
                <span class="category-icon" [style.color]="selectedCategoryData?.color">
                    {{ selectedCategoryData?.icon }}
                </span>
                {{ selectedCategoryData?.name }}
            </h2>
            <button class="btn-primary" (click)="showForm = !showForm">
                <span class="btn-icon">{{ showForm ? '√ó' : '+' }}</span>
                {{ showForm ? 'Cancel' : 'Add Item' }}
            </button>
        </div>

        <!-- Add Resource Form -->
        <div *ngIf="showForm" class="add-form">
            <div class="form-row">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" [(ngModel)]="newResource.title" placeholder="e.g. Senior Developer Resume 2024"
                        class="input-field">
                </div>
            </div>

            <div class="form-group">
                <label>Content</label>
                <div class="content-input-group">
                    <textarea [(ngModel)]="newResource.content" rows="6"
                        placeholder="Paste your content here or upload a file..." class="input-field"></textarea>
                    <input type="file" #fileInput (change)="onFileSelected($event)" style="display: none">
                    <button type="button" class="btn-secondary btn-upload" (click)="fileInput.click()">
                        üìé Attach File
                    </button>
                </div>
                <p *ngIf="selectedFileName" class="file-selected">üìÑ {{ selectedFileName }}</p>
            </div>

            <div class="form-group">
                <label>Tags (comma separated)</label>
                <input type="text" [(ngModel)]="newResource.tags" placeholder="e.g. senior, backend, 2024"
                    class="input-field">
            </div>

            <div class="form-actions">
                <button class="btn-primary" (click)="addResource()">Save Resource</button>
            </div>
        </div>

        <!-- File List -->
        <div class="file-list">
            <div *ngFor="let res of filteredResources" class="file-item">
                <div class="file-item-icon">
                    <span *ngIf="isFilePath(res.content)">üìÑ</span>
                    <span *ngIf="!isFilePath(res.content)">üìù</span>
                </div>
                <div class="file-item-content">
                    <h4 class="file-title">{{ res.title }}</h4>
                    <div class="file-meta">
                        <span class="file-date">{{ res.updatedAt | date:'dd/MM/yyyy' }}</span>
                        <span *ngIf="res.tags" class="file-tags">
                            <span *ngFor="let tag of res.tags.split(',').slice(0, 3)" class="tag-badge">
                                {{ tag.trim() }}
                            </span>
                        </span>
                    </div>
                    <p *ngIf="!isFilePath(res.content) && res.content" class="file-preview">
                        {{ res.content | slice:0:120 }}{{ res.content.length > 120 ? '...' : '' }}
                    </p>
                </div>
                <div class="file-item-actions">
                    <a *ngIf="isFilePath(res.content)" [href]="res.content" target="_blank" class="btn-action"
                        title="Open file">
                        üëÅÔ∏è
                    </a>
                    <button class="btn-action btn-delete" (click)="deleteResource(res.id)" title="Delete">
                        üóëÔ∏è
                    </button>
                </div>
            </div>
        </div>

        <div *ngIf="filteredResources.length === 0 && !showForm" class="empty-folder">
            <div class="empty-icon">üì≠</div>
            <h3>No items yet</h3>
            <p>Add your first item to get started</p>
            <button class="btn-primary" (click)="showForm = true">+ Add Item</button>
        </div>
    </div>
</div>